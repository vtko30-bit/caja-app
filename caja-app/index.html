<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <title>Caja - Movimientos</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0f766e" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="offline-banner" class="offline-banner hidden">Sin conexión. Los cambios se guardarán al reconectar.</div>

    <header class="topbar">
      <div class="topbar-left">
        <h1>Caja</h1>
        <span id="badge-mode" class="badge">Local</span>
      </div>
      <div class="topbar-right">
        <button type="button" class="btn secondary" id="btn-ver-eliminados" style="display: none;">Ver eliminados</button>
        <button id="btn-export" class="btn secondary">Exportar JSON</button>
        <label class="btn secondary file-btn">
          Importar JSON
          <input id="file-import" type="file" accept="application/json" hidden />
        </label>
      </div>
    </header>

    <main class="layout">
      <section class="card card-form">
        <h2>Nuevo movimiento</h2>
        <form id="movement-form">
          <div class="field">
            <label for="date">Fecha</label>
            <div class="date-input-wrap">
              <input id="date" name="date" type="date" required />
              <button type="button" class="date-picker-btn" id="btn-open-calendar" title="Abrir calendario" aria-label="Abrir calendario">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="field">
            <label for="local">Local</label>
            <input
              id="local"
              name="local"
              type="text"
              list="local-datalist"
              placeholder="Ej: Sucursal centro"
              autocomplete="off"
            />
            <datalist id="local-datalist"></datalist>
          </div>
          <div class="field">
            <label for="concept">Concepto</label>
            <input
              id="concept"
              name="concept"
              type="text"
              list="concept-datalist"
              placeholder="Ej: Venta contado"
              autocomplete="off"
              required
            />
            <datalist id="concept-datalist"></datalist>
          </div>
          <div class="field-inline">
            <div class="field">
              <label for="type">Tipo</label>
              <select id="type" name="type" required>
                <option value="ingreso">Ingreso</option>
                <option value="egreso">Egreso</option>
              </select>
            </div>
            <div class="field">
              <label for="amount">Monto</label>
              <input
                id="amount"
                name="amount"
                type="number"
                step="0.01"
                min="0"
                required
              />
            </div>
          </div>
          <div class="field">
            <label for="notes">Notas</label>
            <textarea
              id="notes"
              name="notes"
              rows="2"
              placeholder="Detalle adicional..."
            ></textarea>
          </div>
          <div class="actions">
            <button type="submit" class="btn primary">Guardar</button>
            <button type="reset" class="btn ghost" id="btn-clear-form">
              Limpiar
            </button>
          </div>
        </form>
      </section>

      <section class="card card-summary">
        <h2>Resumen</h2>
        <div class="summary-grid">
          <div>
            <span class="summary-label">Ingresos</span>
            <span id="sum-ingresos" class="summary-value positive">$ 0,00</span>
          </div>
          <div>
            <span class="summary-label">Egresos</span>
            <span id="sum-egresos" class="summary-value negative">$ 0,00</span>
          </div>
          <div>
            <span class="summary-label">Saldo</span>
            <span id="sum-saldo" class="summary-value saldo">$ 0,00</span>
          </div>
        </div>
      </section>

      <section class="card card-table">
        <div class="table-header">
          <h2>Movimientos</h2>
          <div class="table-filters">
            <input
              id="filter-text"
              type="text"
              placeholder="Filtrar por concepto o local..."
            />
            <select id="filter-type">
              <option value="todos">Todos</option>
              <option value="ingreso">Solo ingresos</option>
              <option value="egreso">Solo egresos</option>
            </select>
            <span class="filter-date-range">
              <label for="filter-date-desde" class="filter-date-label">Desde</label>
              <input id="filter-date-desde" type="date" title="Fecha desde" />
              <label for="filter-date-hasta" class="filter-date-label">Hasta</label>
              <input id="filter-date-hasta" type="date" title="Fecha hasta" />
              <button type="button" class="btn btn-filter-clear" id="btn-clear-date-filter" title="Quitar filtro de fechas para ver todos los movimientos">
                Quitar fechas
              </button>
            </span>
          </div>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Local</th>
                <th>Concepto</th>
                <th>Tipo</th>
                <th>Monto</th>
                <th>Notas</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="movements-body"></tbody>
          </table>
        </div>
      </section>
    </main>

    <section id="panel-deleted" class="panel-deleted hidden">
      <div class="panel-deleted-header">
        <h2>Registro de movimientos eliminados</h2>
        <button type="button" class="btn secondary" id="btn-volver-movimientos">Volver a movimientos</button>
      </div>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Local</th>
              <th>Concepto</th>
              <th>Tipo</th>
              <th>Monto</th>
              <th>Notas</th>
              <th>Eliminado el</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="deleted-body"></tbody>
        </table>
      </div>
    </section>

    <div id="toast" class="toast hidden"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("service-worker.js")
            .catch(() => {});
        });
      }
    </script>
  </body>
</html>

